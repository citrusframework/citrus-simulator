<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Christoph Deppisch, Martin Maher, Georgi Todorov">
<title>Citrus Simulator</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>

    h1, h2, h3, h4, h5, h6, #toctitle {
        color: #3b73af;
    }

    div#toctitle {
        content: url("images/citrus-logo-tiny.png");
    }

</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Citrus Simulator</h1>
<div class="details">
<span id="author" class="author">Christoph Deppisch</span><br>
<span id="author2" class="author">Martin Maher</span><br>
<span id="author3" class="author">Georgi Todorov</span><br>
<span id="revnumber">version 1.0.0,</span>
<span id="revdate">2017-09-21</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">citrus-simulator</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#project-status">1.1. Project status</a></li>
<li><a href="#project-prerequisites">1.2. Prerequisites</a>
<ul class="sectlevel3">
<li><a href="#limitations-java-8">1.2.1. Java 8</a></li>
<li><a href="#limitations-browser">1.2.2. Browser</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#installation">2. Installation</a>
<ul class="sectlevel2">
<li><a href="#gradle">2.1. Build with Gradle</a></li>
<li><a href="#maven">2.2. Build with Maven</a></li>
<li><a href="#maven-archetype">2.3. Maven archetypes</a></li>
<li><a href="#development">2.4. Development</a></li>
</ul>
</li>
<li><a href="#concepts">3. Concepts</a>
<ul class="sectlevel2">
<li><a href="#concept-simulator-application">3.1. Simulator application</a></li>
<li><a href="#concept-simulator-properties">3.2. Simulator properties</a>
<ul class="sectlevel3">
<li><a href="#concept-simulator-system-properties">3.2.1. System properties</a></li>
<li><a href="#concept-simulator-environment-variables">3.2.2. Environment variables</a></li>
</ul>
</li>
<li><a href="#concept-simulator-spring-configuration">3.3. Spring bean configuration</a></li>
<li><a href="#scenario-mapper">3.4. Scenario mapper</a>
<ul class="sectlevel3">
<li><a href="#scenario-mapper-default">3.4.1. Default behavior</a></li>
<li><a href="#mapping-key-exctractor-configuration">3.4.2. Configuration</a></li>
</ul>
</li>
<li><a href="#scenarios">3.5. Simulator scenarios</a></li>
<li><a href="#intermediate-messages">3.6. Intermediate Messages</a></li>
</ul>
</li>
<li><a href="#rest">4. REST support</a>
<ul class="sectlevel2">
<li><a href="#rest-config">4.1. Configuration</a></li>
<li><a href="#rest-customization">4.2. Advanced customizations</a></li>
<li><a href="#rest-request-mapping">4.3. Request mapping</a></li>
<li><a href="#rest-status-code">4.4. Http responses</a></li>
<li><a href="#rest-swagger">4.5. Swagger support</a>
<ul class="sectlevel3">
<li><a href="#swagger-system-properties">4.5.1. Swagger system properties</a></li>
<li><a href="#data-dictionaries">4.5.2. Data dictionaries</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#web-service">5. Web Service support</a>
<ul class="sectlevel2">
<li><a href="#web-service-config">5.1. Configuration</a></li>
<li><a href="#web-service-customization">5.2. Advanced customizations</a></li>
<li><a href="#web-service-response">5.3. SOAP response</a></li>
<li><a href="#web-service-faults">5.4. SOAP faults</a></li>
<li><a href="#web-service-wsdl">5.5. WSDL support</a>
<ul class="sectlevel3">
<li><a href="#wsdl-system-properties">5.5.1. WSDL system properties</a></li>
<li><a href="#data-dictionaries-2">5.5.2. Data dictionaries</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jms">6. JMS support</a>
<ul class="sectlevel2">
<li><a href="#jms-config">6.1. Configuration</a></li>
<li><a href="#jms-async">6.2. Asynchronous communication</a></li>
<li><a href="#jms-sync">6.3. Synchronous communication</a></li>
</ul>
</li>
<li><a href="#endpoint">7. Endpoint support</a>
<ul class="sectlevel2">
<li><a href="#endpoint-config">7.1. Configuration</a></li>
</ul>
</li>
<li><a href="#user-interface">8. User interface</a>
<ul class="sectlevel2">
<li><a href="#ui-dashboard">8.1. Dashboard</a></li>
<li><a href="#ui-scenarios">8.2. Scenarios</a></li>
<li><a href="#ui-activity">8.3. Activities</a></li>
<li><a href="#messages">8.4. Messages</a></li>
</ul>
</li>
<li><a href="#starter">9. Starter</a>
<ul class="sectlevel2">
<li><a href="#starter-parameter">9.1. Starter Parameter</a></li>
</ul>
</li>
<li><a href="#samples">10. Samples</a>
<ul class="sectlevel2">
<li><a href="#samples-rest">10.1. REST sample</a></li>
<li><a href="#samples-soap">10.2. SOAP sample</a></li>
<li><a href="#samples-jms">10.3. JMS sample</a></li>
<li><a href="#samples-mail">10.4. Mail sample</a></li>
<li><a href="#samples-combined">10.5. Combined sample</a></li>
</ul>
</li>
<li><a href="#links">11. Links &amp; Further reading</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Copyright Â© 2017 ConSol Software GmbH</strong><br>
<strong>Version: 1.0.0</strong></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/citrus-logo-small.png" alt="citrus-logo"></span></p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a standalone simulator for different messaging transports such as Http REST, SOAP WebService,
JMS, RMI, mail messaging and more.</p>
</div>
<div class="paragraph">
<p>The simulator provides server APIs for clients and responds with predefined messages according to
defined scenarios. The simulator response logic is very powerful and enables us to simulate any kind of server interface.</p>
</div>
<div class="paragraph">
<p>The simulator uses <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> in combination with the test framework <a href="https://www.citrusframework.org">Citrus</a>. You can
code simulator scenarios in Java or XML. Each scenario execution on the simulator is stored to an internal database and can be reviewed via web UI in the browser.</p>
</div>
<div class="paragraph">
<p>Feedback and contributions are highly appreciated!</p>
</div>
<div class="sect2">
<h3 id="project-status"><a class="anchor" href="#project-status"></a>1.1. Project status</h3>
<div class="paragraph">
<p><strong>NOTE:</strong> <em>This project is considered stable but still under construction!</em></p>
</div>
<div class="paragraph">
<p>The simulator application is stable not yet finished. Some features are still under construction. Some aspects are simply not covered yet. Please see the following experimental
features.</p>
</div>
<div class="hdlist">
<div class="title">Experimental features</div>
<table>
<tr>
<td class="hdlist1">
WSDL generated scenarios
</td>
<td class="hdlist2">
<p>Auto generate simulator scenarios from WSDL file</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Swagger generated scenarios
</td>
<td class="hdlist2">
<p>Auto generate simulator scenarios from Swagger API file</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Combined simulator
</td>
<td class="hdlist2">
<p>Use multiple message transports in one simulator instance</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following from that we have to deal with some limitations and trade offs until the project emerges (hopefully with the help of the community, keeping our fingers crossed!).
However the simulator is usable and all main features are considered to be stable.</p>
</div>
</div>
<div class="sect2">
<h3 id="project-prerequisites"><a class="anchor" href="#project-prerequisites"></a>1.2. Prerequisites</h3>
<div class="paragraph">
<p>You may want to check the following prerequisites for using the simulator application.</p>
</div>
<div class="sect3">
<h4 id="limitations-java-8"><a class="anchor" href="#limitations-java-8"></a>1.2.1. Java 8</h4>
<div class="paragraph">
<p>The simulator is a Java application coded in Java 8. Following from that you need at least Java 8 to run it as a Spring Boot web application.
Please make sure that you have Java development kit installed and set up. You can verify this with this command in a new terminal window.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -version</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="limitations-browser"><a class="anchor" href="#limitations-browser"></a>1.2.2. Browser</h4>
<div class="paragraph">
<p>The simulator provides a small web user interface when started. You can access this web UI with your browser. As we are in an early state in this project we do not
invest much time in full cross-browser compatibility. We use Chrome and Firefox during development. So the simulator application is most likely to be 100% working
on these two browsers. Of course other browsers might work without any limitations, too.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation"><a class="anchor" href="#installation"></a>2. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Citrus simulator is a web application that uses Spring boot and Angular2. The simulator is able to run as Java application on your local machine
or as container/pod in Docker, Kubernetes or Openshift.</p>
</div>
<div class="paragraph">
<p>You can use any build system you like when building the simulator application. Here we show how to setup everything using <a href="http://gradle.org/">Gradle</a> and <a href="https://maven.apache.org/">Maven</a>.</p>
</div>
<div class="sect2">
<h3 id="gradle"><a class="anchor" href="#gradle"></a>2.1. Build with Gradle</h3>
<div class="paragraph">
<p>Gradle uses groovy build scripts that we have to add first when starting a new simulator project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-gradle-plugin:1.5.6.RELEASE</span><span class="delimiter">&quot;</span></span>)
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">eclipse</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">idea</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot</span><span class="delimiter">'</span></span>

jar {
    group = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.simulator</span><span class="delimiter">&quot;</span></span>
    baseName = <span class="string"><span class="delimiter">'</span><span class="content">citrus-simulator-sample</span><span class="delimiter">'</span></span>
    version =  <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

sourceCompatibility = <span class="float">1.8</span>
targetCompatibility = <span class="float">1.8</span>

dependencies {
    compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter</span><span class="delimiter">&quot;</span></span>)
    compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-web</span><span class="delimiter">&quot;</span></span>)
    compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus:citrus-simulator-starter:1.0.0</span><span class="delimiter">&quot;</span></span>)
    testCompile(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above build script will setup the Spring Boot dependencies for you. In addition to that we add the basic <code>citrus-simulator-starter</code> dependency. That&#8217;s it for the Gradle build.
We are ready to build and run the simulator now.</p>
</div>
<div class="paragraph">
<p>Before we do that let&#8217;s add a basic Spring Boot main class to our project.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/consol/citrus/simulator/Simulator.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.simulator</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.http.SimulatorRestAdapter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorRestAdapter {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also we add an default scenario that is executed for incoming requests.</p>
</div>
<div class="listingblock">
<div class="title">DefaultScenario.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.simulator</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.http.message.HttpMessage</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.scenario</span>.*;
<span class="keyword">import</span> <span class="include">org.springframework.http.HttpStatus</span>;

<span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DEFAULT_SCENARIO</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner designer) {
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Default scenario executed!</span><span class="delimiter">&quot;</span></span>);

        designer.send()
                .message(<span class="keyword">new</span> HttpMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome to the Citrus simulator</span><span class="delimiter">&quot;</span></span>)
                .status(HttpStatus.OK));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default scenario responds with <code>Http 200 OK</code>.</p>
</div>
<div class="paragraph">
<p>You can now build and run the simulator application with:</p>
</div>
<div class="listingblock">
<div class="title">Gradle build</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew build bootRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see the application starting up. Usually you will see some console log output. The web server should start within seconds. Once the application is up and running
you can open your browser and point to <a href="http://localhost:8080">http://localhost:8080</a>. You will see the very basic simulator user interface. For a more detailed user interface please
follow <a href="#user-interface">chapter user-interface</a>.</p>
</div>
<div class="paragraph">
<p>The REST default scenario that we have added is accessible using <a href="http://localhost:8080/services/rest/">http://localhost:8080/services/rest/</a>. You will see the default output <code>Welcome to the Citrus simulator</code>
coming from default scenario execution.</p>
</div>
<div class="paragraph">
<p>That&#8217;s it you are ready to use the Citrus simulator now. Next thing would be to understand the <a href="#concepts">concepts</a> and create some <a href="#scenarios">simulator scenarios</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="maven"><a class="anchor" href="#maven"></a>2.2. Build with Maven</h3>
<div class="paragraph">
<p>You can use the simulator in your Maven project. Maven will automatically download all required dependencies and project artifacts for you. The simulator is then executable
as a web archive representing the the latest simulator distribution.</p>
</div>
<div class="paragraph">
<p>See the following sample Maven project POM file that defines the project sources as Spring boot application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>

  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-simulator-sample<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;name&gt;</span>${project.artifactId}<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;version&gt;</span>1.0.0<span class="tag">&lt;/version&gt;</span>

  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
    <span class="tag">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.reporting.outputEncoding&gt;</span>
    <span class="tag">&lt;citrus.simulator.version&gt;</span>1.0.0<span class="tag">&lt;/citrus.simulator.version&gt;</span>
    <span class="tag">&lt;spring.boot.version&gt;</span>1.5.6.RELEASE<span class="tag">&lt;/spring.boot.version&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>

  <span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
      <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-dependencies<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>${spring.boot.version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
      <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
  <span class="tag">&lt;/dependencyManagement&gt;</span>

  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>

    <span class="comment">&lt;!-- Citrus Simulator --&gt;</span>

    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>citrus-simulator-starter<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>${citrus.simulator.version}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>

  <span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.5.1<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;encoding&gt;</span>${project.build.sourceEncoding}<span class="tag">&lt;/encoding&gt;</span>
          <span class="tag">&lt;source&gt;</span>1.8<span class="tag">&lt;/source&gt;</span>
          <span class="tag">&lt;target&gt;</span>1.8<span class="tag">&lt;/target&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span>

      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.0.0<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;failOnMissingWebXml&gt;</span>false<span class="tag">&lt;/failOnMissingWebXml&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span>

      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>${spring.boot.version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;fork&gt;</span>true<span class="tag">&lt;/fork&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
  <span class="tag">&lt;/build&gt;</span>

<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above Maven pom file will setup the Spring Boot dependencies for you. In addition to that we add the basic <code>citrus-simulator-starter</code> dependency. We are now finished with the build setup and
we are ready to build and run the simulator.</p>
</div>
<div class="paragraph">
<p>Before we do that let&#8217;s add a basic Spring Boot main class to our project.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/consol/citrus/simulator/Simulator.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.simulator</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.http.SimulatorRestAdapter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorRestAdapter {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also we add an default scenario that is executed for incoming requests.</p>
</div>
<div class="listingblock">
<div class="title">DefaultScenario.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.simulator</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.http.message.HttpMessage</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.scenario</span>.*;
<span class="keyword">import</span> <span class="include">org.springframework.http.HttpStatus</span>;

<span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DEFAULT_SCENARIO</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner designer) {
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Default scenario executed!</span><span class="delimiter">&quot;</span></span>);

        designer.send()
                .message(<span class="keyword">new</span> HttpMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome to the Citrus simulator</span><span class="delimiter">&quot;</span></span>)
                .status(HttpStatus.OK));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default scenario responds with <code>Http 200 OK</code>.</p>
</div>
<div class="paragraph">
<p>You can now build and run the simulator with Maven from a command line. Use following commands:</p>
</div>
<div class="listingblock">
<div class="title">Maven build</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn clean install spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see the application starting up. Usually you will see some console log output. The web server should start within seconds. Once the application is up and running
you can open your browser and point to <a href="http://localhost:8080">http://localhost:8080</a>. You will see the very basic simulator user interface. For a more detailed user interface please
follow <a href="#user-interface">chapter user-interface</a>.</p>
</div>
<div class="paragraph">
<p>The REST default scenario that we have added is accessible using <a href="http://localhost:8080/services/rest/">http://localhost:8080/services/rest/</a>. You will see the default output <code>Welcome to the Citrus simulator</code>
coming from default scenario execution.</p>
</div>
<div class="paragraph">
<p>That&#8217;s it you are ready to use the Citrus simulator now. Next thing would be to understand the <a href="#concepts">concepts</a> and create some <a href="#scenarios">simulator scenarios</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="maven-archetype"><a class="anchor" href="#maven-archetype"></a>2.3. Maven archetypes</h3>
<div class="paragraph">
<p>The easiest way to get started with a new simulator project is to use a Maven archetype that creates a new project for you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn archetype:generate -B -DarchetypeGroupId=com.consol.citrus.archetypes \
                            -DarchetypeArtifactId=citrus-simulator-archetype-rest \
                            -DarchetypeVersion=${citrus.simulator.version} \
                            -DgroupId=com.consol.citrus.simulator \
                            -DartifactId=citrus-simulator-rest \
                            -Dversion=1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you execute the command above the Maven archetype generator will ask you some questions about versions and project names. Once you have completed the generation
you get a new Maven project that is ready to use. The project is created in a new folder on your machine. Switch to that folder and continue to build the project.</p>
</div>
<div class="paragraph">
<p>There are different simulator archetypes available. Please pick the most convenient archetype according to your project purpose.</p>
</div>
<div class="hdlist">
<div class="title">Maven archetypes</div>
<table>
<tr>
<td class="hdlist1">
citrus-simulator-archetype-rest
</td>
<td class="hdlist2">
<p>Http REST simulator sample</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus-simulator-archetype-ws
</td>
<td class="hdlist2">
<p>SOAP web service simulator sample</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus-simulator-archetype-jms
</td>
<td class="hdlist2">
<p>JMS simulator sample</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus-simulator-archetype-mail
</td>
<td class="hdlist2">
<p>Mail simulator sample</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus-simulator-archetype-swagger
</td>
<td class="hdlist2">
<p>Auto generate simulator from Swagger Open API specification (<em>experimental</em>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus-simulator-archetype-wsdl
</td>
<td class="hdlist2">
<p>Auto generate simulator from SOAP WSDL specification (<em>experimental</em>)</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="development"><a class="anchor" href="#development"></a>2.4. Development</h3>
<div class="paragraph">
<p>Once the project build and sources are setup you can start to code some simulator scenarios. The project is a normal Java project that you can work with in your
favorite Java IDE. Build tools like Maven and Gradle compile and package the simulator to an executable artifact. Usually this is a Spring boot web archive.</p>
</div>
<div class="paragraph">
<p>The simulator web application should start within seconds. Once the application is up and running on your local machine
you can open your browser and point to <a href="http://localhost:8080">http://localhost:8080</a>.</p>
</div>
<div class="paragraph">
<p>Now everything is set up and you can start to create some simulator scenarios.</p>
</div>
<div class="paragraph">
<p>That&#8217;s it you are ready to use the Citrus simulator.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concepts"><a class="anchor" href="#concepts"></a>3. Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Citrus simulator&#8217;s primary focus is to provide a simple means to simulate one or more endpoints (HTTP, JMS, SMTP, etc). Once the simulator is up and running it waits for an incoming request (JSON, SOAP, XML, etc) to arrive on any of its configured endpoints and reacts accordingly. The simulator examines the incoming request and determines which <a href="#scenarios">simulator scenario</a> should be executed for handling the request. Typically the selected scenario creates a response message to send back to the calling client.</p>
</div>
<div class="paragraph">
<p>A <a href="#scenario-mapper">scenario mapper</a> is used to help the simulator determine the correct scenario to be executed. Different scenario mappers are supported that use the request header data or payload data to determine the appropriate scenario to run.</p>
</div>
<div class="paragraph">
<p>A <a href="#scenarios">simulator scenario</a> is capable of handling one or more request messages. When executed it receives the request and can return an appropriate response message to the calling client.
By defining multiple simulator scenarios the citrus simulator is able to respond to different requests accordingly.</p>
</div>
<div class="paragraph">
<p>A simulator scenario is composed of one or more actions. For the most trivial scenarios there is generally an action for receiving a request and an action for sending a response.
Because the Citrus simulator has access to the underlying Citrus framework functionality you can access a wide range of actions that are available within the Citrus framework and use these when configuring a scenario.</p>
</div>
<div class="paragraph">
<p>To keep an eye on what the simulator is doing, what requests were received or sent or what scenarios were executed a <a href="#user-interface">user interface</a> is provided. In addition to seeing what is going on it is also possible to trigger scenarios manually.</p>
</div>
<div class="sect2">
<h3 id="concept-simulator-application"><a class="anchor" href="#concept-simulator-application"></a>3.1. Simulator application</h3>
<div class="paragraph">
<p>The simulator is a usual Spring boot application. This means we have a main class that loads the Spring boot application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class is the main entrance for all configuration and customization statements. As we have added the <strong>citrus-simulator-starter</strong> as dependency in our project
auto configuration is enabled for the simulator application. By default REST support is enabled with all configuration needed. You can enable/disable the message transport
support for different technologies via application properties.</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">citrus.simulator.rest.enabled=true
citrus.simulator.jms.enabled=true
citrus.simulator.ws.enabled=true
citrus.simulator.ws.client.enabled=true
citrus.simulator.endpoint.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>When enabled the simulator auto configuration for this specific message transport is activated and all required beans and configuration is loaded at startup.</p>
</div>
<div class="hdlist">
<div class="title">Simulator support</div>
<table>
<tr>
<td class="hdlist1">
citrus.simulator.rest.enabled
</td>
<td class="hdlist2">
<p>Enables <a href="#rest-support">Http REST support</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.ws.enabled
</td>
<td class="hdlist2">
<p>Enables <a href="#ws-support">SOAP web services support</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.ws.client.enabled
</td>
<td class="hdlist2">
<p>Enables <a href="#ws-support">SOAP web services support</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.jms.enabled
</td>
<td class="hdlist2">
<p>Enables <a href="#jms-support">JMS support</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.endpoint.enabled
</td>
<td class="hdlist2">
<p>Enables generic <a href="#endpoint-component-support">endpoint component support</a></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also combine message transports on the simulator application although this feature is of experimental nature up to now.</p>
</div>
</div>
<div class="sect2">
<h3 id="concept-simulator-properties"><a class="anchor" href="#concept-simulator-properties"></a>3.2. Simulator properties</h3>
<div class="paragraph">
<p>The simulator is capable of loading configuration from system properties, environment variables and property files. First of all the default Spring boot properties configuration mechanism
is supported. Following from that you can add properties to the <code>application.properties</code> file in your project resources in order to adjust simulator behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">citrus.simulator.rest.enabled=true
citrus.simulator.defaultTimeout=10000
citrus.simulator.templatePath=com/company/simulator/templates</code></pre>
</div>
</div>
<div class="paragraph">
<p>The available simulator properties are grouped in following configuration classes:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
com.consol.citrus.simulator.config.SimulatorConfigurationProperties
</td>
<td class="hdlist2">
<p>prefix=<strong>citrus.simulator</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
com.consol.citrus.simulator.http.SimulatorRestConfigurationProperties
</td>
<td class="hdlist2">
<p>prefix=<strong>citrus.simulator.rest</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
com.consol.citrus.simulator.ws.SimulatorWebServiceConfigurationProperties
</td>
<td class="hdlist2">
<p>prefix=<strong>citrus.simulator.ws</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
com.consol.citrus.simulator.ws.SimulatorWebServiceClientConfigurationProperties
</td>
<td class="hdlist2">
<p>prefix=<strong>citrus.simulator.ws.client</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
com.consol.citrus.simulator.jms.SimulatorJmsConfigurationProperties
</td>
<td class="hdlist2">
<p>prefix=<strong>citrus.simulator.jms</strong></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are several properties that you can use in order to customize the simulator behavior. These
properties are:</p>
</div>
<div class="hdlist">
<div class="title">Spring boot application properties</div>
<table>
<tr>
<td class="hdlist1">
citrus.simulator.templatePath
</td>
<td class="hdlist2">
<p>Default path to message payload template files.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.defaultScenario
</td>
<td class="hdlist2">
<p>Default scenario name.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.defaultTimeout
</td>
<td class="hdlist2">
<p>Timeout when waiting for inbound messages.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.templateValidation
</td>
<td class="hdlist2">
<p>Enable/disable schema validation.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.exceptionDelay
</td>
<td class="hdlist2">
<p>Default delay in milliseconds to wait after uncategorized exceptions.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.rest.urlMapping
</td>
<td class="hdlist2">
<p>Handler adapter url mapping for inbound requests</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.ws.servletMapping
</td>
<td class="hdlist2">
<p>Message dispatcher servlet mapping for inbound SOAP requests</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.jms.inboundDestination
</td>
<td class="hdlist2">
<p>JMS destination name to consume inbound messages from</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.jms.replyDestination
</td>
<td class="hdlist2">
<p>JMS destination name to publish reply messages to</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please refer to the respective configuration property classes to see what property settings are supported.</p>
</div>
<div class="sect3">
<h4 id="concept-simulator-system-properties"><a class="anchor" href="#concept-simulator-system-properties"></a>3.2.1. System properties</h4>
<div class="paragraph">
<p>In addition to that default Spring boot property replacement the simulator also supports system property and environment variables. The properties are:</p>
</div>
<div class="hdlist">
<div class="title">System property names</div>
<table>
<tr>
<td class="hdlist1">
citrus.simulator.configuration.class
</td>
<td class="hdlist2">
<p>Java configuration class that is automatically loaded. (default is com.consol.citrus.simulator.SimulatorConfig)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.template.path
</td>
<td class="hdlist2">
<p>Default path to message payload template files.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.default.scenario
</td>
<td class="hdlist2">
<p>Default scenario name.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.default.timeout
</td>
<td class="hdlist2">
<p>Timeout when waiting for inbound messages.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.template.validation
</td>
<td class="hdlist2">
<p>Enable/disable schema validation.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.exception.delay
</td>
<td class="hdlist2">
<p>Default delay in milliseconds to wait after uncategorized exceptions.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.rest.url.mapping
</td>
<td class="hdlist2">
<p>Handler adapter url mapping for inbound requests</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.ws.servlet.mapping
</td>
<td class="hdlist2">
<p>Message dispatcher servlet mapping for inbound SOAP requests</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.jms.inbound.destination
</td>
<td class="hdlist2">
<p>JMS destination name to consume inbound messages from</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.simulator.jms.reply.destination
</td>
<td class="hdlist2">
<p>JMS destination name to publish outbound messages to</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can set these properties as system properties when starting the Spring boot web application or you can add the properties to the default
Spring Boot application properties file <strong>application.properties</strong> that is located as resource file in your project.</p>
</div>
<div class="paragraph">
<p>The simulator will automatically load these properties during startup and honor this configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="concept-simulator-environment-variables"><a class="anchor" href="#concept-simulator-environment-variables"></a>3.2.2. Environment variables</h4>
<div class="paragraph">
<p>Same settings that are editable via system properties are also accessible via environment variables. This is extremely helpful when running the simulator in a containerized
infrastructure such as Docker or Kubernetes.</p>
</div>
<div class="hdlist">
<div class="title">Environment settings</div>
<table>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_CONFIGURATION_CLASS
</td>
<td class="hdlist2">
<p>Java configuration class that is automatically loaded. (default is com.consol.citrus.simulator.SimulatorConfig)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_TEMPLATE_PATH
</td>
<td class="hdlist2">
<p>Default path to message payload template files.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_DEFAULT_SCENARIO
</td>
<td class="hdlist2">
<p>Default scenario name.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_DEFAULT_TIMEOUT
</td>
<td class="hdlist2">
<p>Timeout when waiting for inbound messages.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_TEMPLATE_VALIDATION
</td>
<td class="hdlist2">
<p>Enable/disable schema validation.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_EXCEPTION_DELAY
</td>
<td class="hdlist2">
<p>Default delay in milliseconds to wait after uncategorized exceptions.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_REST_URL_MAPPING
</td>
<td class="hdlist2">
<p>Handler adapter url mapping for inbound requests</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_WS_SERVLET_MAPPING
</td>
<td class="hdlist2">
<p>Message dispatcher servlet mapping for inbound SOAP requests</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_JMS_INBOUND_DESTINATION
</td>
<td class="hdlist2">
<p>JMS destination name to consume inbound messages from</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_SIMULATOR_JMS_REPLY_DESTINATION
</td>
<td class="hdlist2">
<p>JMS destination name to publish outbound messages to</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case these environment variables are present on your local system the simulator will automatically load these settings during startup and honor the configuration.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concept-simulator-spring-configuration"><a class="anchor" href="#concept-simulator-spring-configuration"></a>3.3. Spring bean configuration</h3>
<div class="paragraph">
<p>Citrus works with the Spring framework and the simulator is a Spring boot application. Therefore the configuration is done by adding and overwriting Spring beans in
the application context. The simulator automatically loads Spring beans defined in following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>META-INF/citrus-simulator.xml</strong> Xml Spring bean configuration file.</p>
</li>
<li>
<p><strong>com.consol.citrus.simulator.SimulatorConfig</strong> Java configuration class. You can customize this class by defining the property <strong>citrus.simulator.configuration.class</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All beans defined in there get automatically loaded to the simulator Spring application context.</p>
</div>
</div>
<div class="sect2">
<h3 id="scenario-mapper"><a class="anchor" href="#scenario-mapper"></a>3.4. Scenario mapper</h3>
<div class="paragraph">
<p>The scenario mapper implementation decides how to map incoming request message to simulator scenarios. Each incoming request
triggers a predefined scenario that generates the response message for the calling client. The simulator identifies the scenario based
on a mapping key that is extracted from the incoming request.</p>
</div>
<div class="paragraph">
<p>There are multiple ways to identify the simulator scenario from incoming request messages:</p>
</div>
<div class="hdlist">
<div class="title">Scenario mapping identifiers (TODO update list)</div>
<table>
<tr>
<td class="hdlist1">
Message-Type
</td>
<td class="hdlist2">
<p>Each request message type (XML root QName) results in a separate simulator scenario</p>
</td>
</tr>
<tr>
<td class="hdlist1">
REST request mappings
</td>
<td class="hdlist2">
<p>Identifies the scenario based on Http method and resource path on server</p>
</td>
</tr>
<tr>
<td class="hdlist1">
SOAP Action
</td>
<td class="hdlist2">
<p>Each SOAP action value defines a simulator scenario</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Message Header
</td>
<td class="hdlist2">
<p>Any SOAP or Http message header value specifies a new simulator scenario</p>
</td>
</tr>
<tr>
<td class="hdlist1">
XPath payload
</td>
<td class="hdlist2">
<p>An XPath expression is evaluated on the message payload to identify the scenario</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Json payload
</td>
<td class="hdlist2">
<p>An JsonPath expression is evaluated on the message payload to identify the scenario</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Content based xpath mapper
</td>
<td class="hdlist2">
<p>Evaluates Xpath expressions on the request payload and uses the expression result as scenario name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Content based jsonPath mapper
</td>
<td class="hdlist2">
<p>Evaluates JsonPath expressions on the request payload and uses the expression result as scenario name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Header value mapper
</td>
<td class="hdlist2">
<p>Evaluates header name on request and uses header value as scenario name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
SOAP action mapper
</td>
<td class="hdlist2">
<p>Evaluates SOAP action header on request and uses the value as scenario name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Request mapping annotation mapper
</td>
<td class="hdlist2">
<p>Uses Spring @RequestMapping annotations on scenarios in order to map incoming requests based on request method and/or request path values</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the simulator scenario is identified with the respective mapping key the scenario get loaded and executed. All scenarios perform Citrus test logic in order
to provide a proper response messages as a result. This way the simulator is able to perform complex response generating logic with dynamic values and so on.</p>
</div>
<div class="paragraph">
<p>The mentioned mapping key extraction strategies are implemented in these classes:</p>
</div>
<div class="hdlist">
<div class="title">Scenario mapper implementations</div>
<table>
<tr>
<td class="hdlist1">
HttpRequestAnnotationScenarioMapper
</td>
<td class="hdlist2">
<p>Evaluates REST request mappings</p>
</td>
</tr>
<tr>
<td class="hdlist1">
SoapActionScenarioMapper
</td>
<td class="hdlist2">
<p>Evaluates the SOAP action header</p>
</td>
</tr>
<tr>
<td class="hdlist1">
HeaderValueScenarioMapper
</td>
<td class="hdlist2">
<p>Evaluates any message header</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ContentBasedXPathScenarioMapper
</td>
<td class="hdlist2">
<p>Evaluates a XPath expression on the message payload</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ContentBasedJsonPathScenarioMapper
</td>
<td class="hdlist2">
<p>Evaluates a JsonPath expression on the message payload</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course you can also implement a custom scenario mapper, too. Just implement the interface methods of that API and add the implementation to the simulator
configuration as described later on in this document.</p>
</div>
<div class="sect3">
<h4 id="scenario-mapper-default"><a class="anchor" href="#scenario-mapper-default"></a>3.4.1. Default behavior</h4>
<div class="paragraph">
<p>The default mapping key logic extracts the message type of incoming requests. This is done by evaluating a Xpath expression on the request payload that uses the root element of the message as the
mapping key. Each message type gets its own simulator scenario.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s demonstrate that in a simple example. We know three different message types named <strong>successMessage</strong>, <strong>warningMessage</strong> and <strong>errorMessage</strong>. We create a simulator scenario for each of these message types with
respective naming. Given the following incoming requests the simulator will pick the matching scenario for execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;successMessage&gt;</span>
    <span class="tag">&lt;text&gt;</span>This is a success message<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/successMessage&gt;</span>

<span class="tag">&lt;warningMessage&gt;</span>
    <span class="tag">&lt;text&gt;</span>This is a warning message<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/warningMessage&gt;</span>

<span class="tag">&lt;errorMessage&gt;</span>
    <span class="tag">&lt;text&gt;</span>This is a error message<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/errorMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The simulator evaluates the root element name and maps the requests to the matching scenario. Each scenario implements different response generating logic so the simulator is able to respond to a <strong>successMessage</strong> in a different
way than for <strong>errorMessage</strong> types.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-key-exctractor-configuration"><a class="anchor" href="#mapping-key-exctractor-configuration"></a>3.4.2. Configuration</h4>
<div class="paragraph">
<p>You can change the mapping key behavior by overwriting te default scenario mapper in your simulator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimulatorAdapter</span> <span class="directive">extends</span> SimulatorRestAdapter {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        HeaderValueScenarioMapper scenarioMapper = <span class="keyword">new</span> HeaderValueScenarioMapper();
        scenarioMapper.setHeaderName(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-simulator-scenario</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> scenarioMapper;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the configuration above we use the <em>HeaderValueScenarioMapper</em> implementation so the header name <strong>X-simulator-scenario</strong> gets evaluated for each incoming request message.
Depending on that header value the matching scenario is executed as a result. The scenario mapper is just a bean in the Spring application context. There is a default implementation but you can overwrite
this behavior very easy in the simulator adapter configuration. Read more about how to add simulator adapter configuration classes in configuration chapters <a href="#rest-config">rest-config</a>, <a href="#ws-config">ws-config</a>
or <a href="#jms-config">jms-config</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scenarios"><a class="anchor" href="#scenarios"></a>3.5. Simulator scenarios</h3>
<div class="paragraph">
<p>The simulator provides the response generating logic by defining one to many scenarios that get executed based on the incoming request. The different scenarios on the simulator
describe different response messages and stand for individual simulation logic. Each scenario is capable of receiving and validating the incoming request message. Based on that the scenario
is in charge of constructing a proper response message.</p>
</div>
<div class="paragraph">
<p>First of all the scenario gets a name under which mapping strategies can identify the scenario. This name is very important when it comes to mapping incoming requests to scenarios. Besides that
the scenario is a normal Java class that implements following interface <em>SimulatorScenario</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.simulator.scenario</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">SimulatorScenario</span> {
    ScenarioEndpoint getScenarioEndpoint();

    <span class="keyword">default</span> <span class="type">void</span> run(ScenarioDesigner designer) {}

    <span class="keyword">default</span> <span class="type">void</span> run(ScenarioRunner runner) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The simulator scenario provides access to the endpoint that has been invoked to start this scenario. In the scenario logic you can receive that request message using this endpoint. Also you can send back a
response using this scenario endpoint. The scenario logic goes to one of the default run methods depending on what designer or runner Java DSL API you want to use. Fortunately there is an abstract default
implementation <code>com.consol.citrus.simulator.scenario.AbstractSimulatorScenario</code> that you can inherit from.</p>
</div>
<div class="paragraph">
<p>So a typical simulator scenario can look like the following code sample.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Hello xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Say Hello!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/Hello&gt;</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;HelloResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi there!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/HelloResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we extend from <strong>AbstractSimulatorScenario</strong>. We just add receive and send logic for generating the response message in the designer run method. The scenario above is annotated with <strong>@Scenario</strong>
for defining a scenario name. There is one single <strong>configure</strong> method to be implemented. We can use Citrus Java DSL methods in the method body in order to receive the incoming request and send back a proper response message.
Of course we can use the full Citrus power here in order to construct different message payloads such as XML, JSON, PLAINTEXT and so on.</p>
</div>
<div class="paragraph">
<p>So we could also extract dynamic values from the request in order to reuse those in our response message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Hello xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;user&gt;@ignore@&lt;/user&gt;</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/Hello&gt;</span><span class="delimiter">&quot;</span></span>)
            .extractFromPayload(<span class="string"><span class="delimiter">&quot;</span><span class="content">/Hello/user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;HelloResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;text&gt;Hi there ${userName}!&lt;/text&gt;</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/HelloResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the receive operation the user name value is extracted to a test variable <strong>${userName}</strong>. In the response we are able to use this variable in order to greet the user by name. This way
we can use the Citrus test power for generating dynamic response messages. Of course this mechanism works for XML, Json and Plaintext payloads.</p>
</div>
<div class="paragraph">
<p>Now you are ready to write different scenarios that generate different response messages for the calling client. Just remember the scenarios do get unique names that match a value that is evaluated through the scenario mapper. With this
mechanism we are able to code different simulator scenarios for different incoming request messages. Also with the Citrus send and receive operations we are able to handle messages of different transport types.</p>
</div>
<div class="paragraph">
<p>Read more about special message transport support in chapters <a href="#rest">rest-support</a>, <a href="#web-service">web-service-support</a>, <a href="#jms">jms-support</a>, <a href="#endpoint">endpoint-support</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="intermediate-messages"><a class="anchor" href="#intermediate-messages"></a>3.6. Intermediate Messages</h3>
<div class="paragraph">
<p>The simulator starts a new scenario instance for each incoming request based on the defined scenario mapping. Sometimes a running scenario instance needs to receive another
incoming request. The simulator has to handle things in a different way then because the incoming request should not trigger an new scenario instance but forward that request to the running
scenario.</p>
</div>
<div class="paragraph">
<p>This mechanism is called intermediate message handling in scenarios. The scenario can activate the message correlation for a certain request. The simulator will always check all running scenarios
for matching intermediate message correlations before starting a new scenario. This mechanism enables us to receive further incoming request within the same scenario instance.</p>
</div>
<div class="paragraph">
<p>Let us clarify this with a simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GoodNightScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;GoodNight xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Go to sleep!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/GoodNight&gt;</span><span class="delimiter">&quot;</span></span>)
            .extractFromHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CorrelationId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span>);

        scenario.correlation().start()
            .onHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CorrelationId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;GoodNightResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Good Night!</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/GoodNightResponse&gt;</span><span class="delimiter">&quot;</span></span>);

        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;IntermediateRequest&gt;In between!&lt;/IntermediateRequest&gt;</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;IntermediateResponse&gt;In between!&lt;/IntermediateResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The scenario above starts a new correlation on the header entry <strong>"X-CorrelationId"</strong> and the variable value <strong>${correlationId}</strong> that has been extracted from first request message. Now the scenario is able to receive
further incoming request messages with the correlation identifier. This makes sure that no other running scenario is catching this message before. The scenario is provided with that specific message first.</p>
</div>
<div class="paragraph">
<p>This is how a scenario instance is able to receive more than one single incoming request. The message correlation is able to run on header values as well as based on XPath expressions evaluated within the message payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">FaxCancelled</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FaxCancelledScenario</span> <span class="directive">extends</span> AbstractFaxScenario {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ROOT_ELEMENT_XPATH = <span class="string"><span class="delimiter">&quot;</span><span class="content">string:local-name(/*)</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> REFERENCE_ID_XPATH = <span class="string"><span class="delimiter">&quot;</span><span class="content">//fax:referenceId</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .xpath(ROOT_ELEMENT_XPATH, <span class="string"><span class="delimiter">&quot;</span><span class="content">SendFaxMessage</span><span class="delimiter">&quot;</span></span>)
            .extractFromPayload(REFERENCE_ID_XPATH, <span class="string"><span class="delimiter">&quot;</span><span class="content">referenceId</span><span class="delimiter">&quot;</span></span>);

        scenario.correlation().start()
                .onPayload(REFERENCE_ID_XPATH, <span class="string"><span class="delimiter">&quot;</span><span class="content">${referenceId}</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send(getStatusEndpoint())
            .payload(
                    getPayloadHelper().generateFaxStatusMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">${referenceId}</span><span class="delimiter">&quot;</span></span>,
                            FaxStatusEnumType.QUEUED,
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">The fax message has been queued and will be send shortly</span><span class="delimiter">&quot;</span></span>),
                    getPayloadHelper().getMarshaller()
            );

        scenario
            .receive()
            .xpath(ROOT_ELEMENT_XPATH, <span class="string"><span class="delimiter">&quot;</span><span class="content">CancelFaxMessage</span><span class="delimiter">&quot;</span></span>)
            .xpath(REFERENCE_ID_XPATH, <span class="string"><span class="delimiter">&quot;</span><span class="content">${referenceId}</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send(getStatusEndpoint())
            .payload(
                    getPayloadHelper().generateFaxStatusMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">${referenceId}</span><span class="delimiter">&quot;</span></span>,
                            FaxStatusEnumType.CANCELLED,
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">The fax message has been cancelled</span><span class="delimiter">&quot;</span></span>),
                    getPayloadHelper().getMarshaller()
            );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above uses XPath expressions to start a new correlation within the scenario. This makes sure that the second incoming request <strong>CancelFaxMessage</strong> is forwarded to this very same scenario.</p>
</div>
<div class="paragraph">
<p>With intermediate message handling we are able to create more complex scenarios that require multiple request/response messages. The message correlation makes sure that the
needed requests are handled within the same scenarion and other parallel running scenarios are not affected.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rest"><a class="anchor" href="#rest"></a>4. REST support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simulator is able to provide Http REST APIs as a server. Clients can call the simulator on request paths using methods such as
Http GET, POST, PUT, DELETE and so on.</p>
</div>
<div class="paragraph">
<p>The generic rest support is activated by setting the property <strong>citrus.simulator.rest.enabled=true</strong>. You can do so in the basic <code>application.properties</code>
file or via system property or environment variable setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>citrus.simulator.rest.enabled</strong> property performs some auto configuration steps and loads required beans for the Spring application context
in the Spring boot application.</p>
</div>
<div class="paragraph">
<p>After that we are ready to handle incoming REST API calls on the simulator.</p>
</div>
<div class="sect2">
<h3 id="rest-config"><a class="anchor" href="#rest-config"></a>4.1. Configuration</h3>
<div class="paragraph">
<p>Once the REST support is enabled on the simulator we have different configuration options. The most comfortable way is to
add a <strong>SimulatorRestAdapter</strong> implementation to the classpath. The adapter provides several configuration methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SimulatorRestAdapter</span> <span class="directive">implements</span> SimulatorRestConfigurer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        <span class="keyword">return</span> <span class="keyword">new</span> HttpRequestAnnotationScenarioMapper();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> HandlerInterceptor<span class="type">[]</span> interceptors() {
        <span class="keyword">return</span> <span class="keyword">new</span> HandlerInterceptor<span class="type">[]</span> { <span class="keyword">new</span> LoggingHandlerInterceptor() };
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> urlMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/services/rest/**</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapter defines methods that configure the simulator REST handling. For instance we can add another scenario mapper implementation or
add handler interceptors to the REST API call handling.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>
The REST support is using the default scenario mapper <strong>HttpRequestAnnotationScenarioMapper</strong> that searches for <strong>@RequestMapping</strong> annotations
on scenario classes. Read more about that in <a href="#rest-request-mapping">rest-request-mapping</a>.</p>
</div>
<div class="paragraph">
<p>The <strong>urlMapping</strong> defines how clients can access the simulator REST API. Assuming the Spring boot simulator application is running on port 8080 the
REST API would be accessible on this URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhhost:8080/services/rest/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>The clients can send GET, POST, DELETE and other calls to that endpoint URI then. The simulator will respond with respective responses based on the called
scenario.</p>
</div>
<div class="paragraph">
<p>You can simply extend the adapter in a custom class for adding customizations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySimulatorRestAdapter</span> <span class="directive">extends</span> SimulatorRestAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> urlMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/my-rest-service/**</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the class is annotated with <strong>@Component</strong> annotation. This is because the adapter should be recognized by Spring in order to overwrite the default
REST adapter behavior. The custom adapter just overwrites the <strong>urlMapping</strong> method so the REST simulator API will be accessible for clients under this endpoint URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhhost:8080/my-rest-service/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the simplest way to customize the simulator REST support. We can also use the adapter extension directly on the Spring boot main application class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.http.SimulatorRestAdapter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorRestAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> urlMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/my-rest-service/**</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        HeaderValueScenarioMapper scenarioMapper = <span class="keyword">new</span> HeaderValueScenarioMapper();
        scenarioMapper.setHeaderName(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-simulator-scenario</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> scenarioMapper;
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest-customization"><a class="anchor" href="#rest-customization"></a>4.2. Advanced customizations</h3>
<div class="paragraph">
<p>For a more advanced configuration option we can extend the <strong>SimulatorRestSupport</strong> implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.http.SimulatorRestAutoConfiguration</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorRestAutoConfiguration {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span> getUrlMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/my-rest-service/**</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> FilterRegistrationBean requestCachingFilter() {
        FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span> FilterRegistrationBean(<span class="keyword">new</span> RequestCachingServletFilter());

        <span class="predefined-type">String</span> urlMapping = getUrlMapping();
        <span class="keyword">if</span> (urlMapping.endsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">**</span><span class="delimiter">&quot;</span></span>)) {
            urlMapping = urlMapping.substring(<span class="integer">0</span>, urlMapping.length() - <span class="integer">1</span>);
        }
        filterRegistrationBean.setUrlPatterns(<span class="predefined-type">Collections</span>.singleton(urlMapping));
        <span class="keyword">return</span> filterRegistrationBean;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> HandlerMapping handlerMapping(ApplicationContext applicationContext) {
        SimpleUrlHandlerMapping handlerMapping = <span class="keyword">new</span> SimpleUrlHandlerMapping();
        handlerMapping.setOrder(Ordered.HIGHEST_PRECEDENCE);
        handlerMapping.setAlwaysUseFullPath(<span class="predefined-constant">true</span>);

        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; mappings = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        mappings.put(getUrlMapping(), getRestController(applicationContext));

        handlerMapping.setUrlMap(mappings);
        handlerMapping.setInterceptors(interceptors());

        <span class="keyword">return</span> handlerMapping;
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that configuration option we can overwrite REST support auto configuration features on the simulator such as the <strong>requestCachingFilter</strong> or the <strong>handlerMapping</strong>.
We extend the <strong>SimulatorRestAutoConfiguration</strong> implementation directly.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest-request-mapping"><a class="anchor" href="#rest-request-mapping"></a>4.3. Request mapping</h3>
<div class="paragraph">
<p>By default the simulator will map incoming requests to scenarios using so called mapping keys that are evaluated on the incoming request. When using REST support on
the simulator we can also use <strong>@RequestMapping</strong> annotations on scenarios in order to map incoming requests.</p>
</div>
<div class="paragraph">
<p>This looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RequestMapping</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/services/rest/simulator/hello</span><span class="delimiter">&quot;</span></span>, method = RequestMethod.POST)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Hello xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Say Hello!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/Hello&gt;</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;HelloResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi there!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/HelloResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the example above uses <strong>@RequestMapping</strong> annotation in addition to the <strong>@Scenario</strong> annotation. All requests on the request path
<strong>/services/rest/simulator/hello</strong> of method <strong>POST</strong> will be mapped to the scenario. With this strategy the simulator is able to map requests based
on methods, request paths and query parameters.</p>
</div>
<div class="paragraph">
<p>The mapping strategy requires a special scenario mapper implementation that is used by default. This scenario mapper automatically scans for scenarios with <strong>@RequestMapping</strong> annotations.
The <strong>HttpRequestAnnotationScenarioMapper</strong> is active by default when enabling REST support on the simulator. Of course you can use traditional scenario mappers, too when using REST.
So in case you need to apply different mapping strategies you can overwrite the scenario mapper implementation in the configuration adapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest-status-code"><a class="anchor" href="#rest-status-code"></a>4.4. Http responses</h3>
<div class="paragraph">
<p>As Http is a synchronous messaging transport by its nature we can provide response messages to the calling client. In Http REST APIs this should include some Http status code.
You can specify the Http status code very easy when using the Citrus Java DSL methods as shown in the next example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RequestMapping</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/services/rest/simulator/hello</span><span class="delimiter">&quot;</span></span>, method = RequestMethod.POST)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .http()
            .receive()
            .post()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Hello xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Say Hello!</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/Hello&gt;</span><span class="delimiter">&quot;</span></span>);

        scenario
            .http()
            .send()
            .response(HttpStatus.OK)
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;HelloResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi there!</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/HelloResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Http Java DSL extension in Citrus provides easy access to Http related identities such as request methods, query parameters and status codes. Please
see the official Citrus documentation for more details how to use this Http specific Java fluent API.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest-swagger"><a class="anchor" href="#rest-swagger"></a>4.5. Swagger support</h3>
<div class="paragraph">
<p>The simulator application is able to read <a href="https://swagger.io/">Swagger</a> <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.0.md">Open API V3.0</a> specifications for auto
generating simulator scenarios for each operation. The Open API specification defines available REST request paths, supported methods (GET, POST, PUT, DELETE, &#8230;&#8203;) and their outcome when clients
call that API operations. The simulator generates basic scenarios for these specification information.</p>
</div>
<div class="paragraph">
<p>See the following sample how to do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorRestAdapter {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        <span class="keyword">return</span> <span class="keyword">new</span> HttpRequestPathScenarioMapper();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> urlMapping(SimulatorRestConfigurationProperties simulatorRestConfiguration) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/petstore/v2/**</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> EndpointAdapter fallbackEndpointAdapter() {
        <span class="keyword">return</span> <span class="keyword">new</span> StaticEndpointAdapter() {
            <span class="annotation">@Override</span>
            <span class="directive">protected</span> Message handleMessageInternal(Message message) {
                <span class="keyword">return</span> <span class="keyword">new</span> HttpMessage().status(HttpStatus.NOT_FOUND);
            }
        };
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="directive">static</span> HttpScenarioGenerator scenarioGenerator() {
        HttpScenarioGenerator generator = <span class="keyword">new</span> HttpScenarioGenerator(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">swagger/petstore-api.json</span><span class="delimiter">&quot;</span></span>));
        generator.setContextPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/petstore</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> generator;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above adds a <code>HttpScenarioGenerator</code> as Spring bean to the simulator application. The generator receives the swagger api file location <code>swagger/petstore-api.json</code> and the
context path for this API. In addition to that we need to set a special scenario mapper implementation <code>HttpRequestPathScenarioMapper</code> that is aware of generated REST scenarios.</p>
</div>
<div class="paragraph">
<p>Also we set a custom fallback endpoint adapter. This one is used when no scenario matches the incoming request or when the scenario itself did not produce a proper response because of
some validation error.</p>
</div>
<div class="paragraph">
<p>On startup the generator dynamically generates a scenario for each operation defined in that swagger api file. You can review all generated scenarios in the user interface.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at a sample operation in that <strong>petstore</strong> swagger api file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">/pet/findByStatus</span><span class="delimiter">&quot;</span></span>: {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">get</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">pet</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Finds Pets by status</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Multiple status values can be provided with comma separated strings</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">operationId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">findPetsByStatus</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">produces</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">in</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Status values that need to be considered for filter</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">enum</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">available</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">pending</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">sold</span><span class="delimiter">&quot;</span></span>
          ],
          <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">available</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">collectionFormat</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>
      }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">responses</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">successful operation</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">schema</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">$ref</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">#/definitions/Pet</span><span class="delimiter">&quot;</span></span>
          }
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid status value</span><span class="delimiter">&quot;</span></span>
      }
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">petstore_auth</span><span class="delimiter">&quot;</span></span>: [
          <span class="string"><span class="delimiter">&quot;</span><span class="content">write:pets</span><span class="delimiter">&quot;</span></span>,
          <span class="string"><span class="delimiter">&quot;</span><span class="content">read:pets</span><span class="delimiter">&quot;</span></span>
        ]
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The REST operation above defines a <strong>GET</strong> method on <strong>/pet/findByStatus</strong>. The required query parameter <strong>status</strong> is defined to filter the returned list of pets. As a response
the API defines <strong>200 OK</strong> with an array of <strong>Pet</strong> objects. In addition to that <strong>400</strong> response is defined when the <strong>status</strong> parameter is not within its restriction enumeration <strong>available, pending, sold</strong>.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> <em>The simulator will always generate the success case exclusively. Here this would be the <strong>200 OK</strong> response. Other response variations are not generated up to now!</em></p>
</div>
<div class="paragraph">
<p>The generated scenario for this operation verifies that the request is using <strong>GET</strong> method on request path <strong>/pet/findByStatus</strong>. Also the scenario verifies the existence of the <strong>status</strong> query
parameter and that the value is within the enumeration boundaries.</p>
</div>
<div class="paragraph">
<p>Only in case these verification steps are performed successfully the simulator scenario generates a proper response <strong>200 OK</strong> that contains a dynamic array of pet objects.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the communication on that scenario:</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="CodeRay highlight"><code>GET http://localhost:8080/petstore/v2/pet/findByStatus?status=pending
Accept:application/json
Content-Type:text/plain;charset=UTF-8
Content-Length:0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="CodeRay highlight"><code>HTTP/1.1 200
X-Application-Context:application
Content-Type:application/json
Content-Length:193
Date:Wed, 13 Sep 2017 08:13:52 GMT

[{"id": 5243024128,"category": {"id": 5032916791,"name": "hneBENfFDq"},"name": "JjZhcsvSRA","photoUrls": ["GwSVIBOhsi"],"tags": [{"id": 8074462757,"name": "DYwotNekKc"}],"status": "available"}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The request did match all verification steps on the simulator for this operation. Following from that we receive a generated response message with some sample data as array of pet objects. The simulator
is able to generate dynamic identifier such as <strong>id</strong>, <strong>category</strong> and <strong>name</strong> values. According to the field type the simulator generates dynamic number of string values. When there is a enumeration value restriction as seen in <strong>status</strong>
the simulator generates a dynamic enumeration value.</p>
</div>
<div class="paragraph">
<p>This is how we always get a proper generated response from the simulator API. The petstore swagger Open API specification defines the returned objects and how to validate the incoming requests.</p>
</div>
<div class="paragraph">
<p>Just in case we sent an invalid request according to the Open API specification we do not get a proper response.</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="CodeRay highlight"><code>GET http://localhost:8080/petstore/v2/pet/findByStatus
Accept:application/json
Content-Type:text/plain;charset=UTF-8
Content-Length:0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="CodeRay highlight"><code>HTTP/1.1 404
X-Application-Context:application
Content-Type:text/plain;charset=UTF-8
Content-Length:0
Date:Wed, 13 Sep 2017 08:42:56 GMT</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample request above is missing the required <strong>status</strong> query parameter on the <strong>findByStatus</strong> operation. As a result we get a <strong>404 NOT_FOUND</strong> response from the fallback endpoint adapter
as the scenario did not complete because of validation errors. You will see the failed scenario activity with proper error message on that missing <strong>status</strong> parameter in the user interface then.</p>
</div>
<div class="sect3">
<h4 id="swagger-system-properties"><a class="anchor" href="#swagger-system-properties"></a>4.5.1. Swagger system properties</h4>
<div class="paragraph">
<p>The simulator Swagger API auto generate scenario feature can also be activated using pure property settings on the Spring boot application. Instead of adding the Spring bean <code>HttpScenarioGenerator</code> in your
simulator configuration you could just set the following properties on the simulator application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># Enable swagger api support
citrus.simulator.rest.swagger.enabled=true
citrus.simulator.rest.swagger.api=classpath:swagger/petstore-api.json
citrus.simulator.rest.swagger.contextPath=/petstore</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also use environment variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">CITRUS_SIMULATOR_REST_SWAGGER_ENABLED=true
CITRUS_SIMULATOR_REST_SWAGGER_API=classpath:swagger/petstore-api.json
CITRUS_SIMULATOR_REST_SWAGGER_CONTEXT_PATH=/petstore</code></pre>
</div>
</div>
<div class="paragraph">
<p>We just add the api file location and everything else is auto configuration done in the simulator application.</p>
</div>
</div>
<div class="sect3">
<h4 id="data-dictionaries"><a class="anchor" href="#data-dictionaries"></a>4.5.2. Data dictionaries</h4>
<div class="paragraph">
<p>Data dictionaries enable us to centralize data manipulation via JsonPath expressions in order to have more dynamic message values in generated request and response message.
When a scenario receives and sends messages the data dictionary is asked for available translations for message elements. This means that
data dictionaries are able to manipulate message content before they are processed.</p>
</div>
<div class="paragraph">
<p>The auto generated scenario references both inbound and outbound data dictionaries. We simply need to enable those in the Spring boot <code>application.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">citrus.simulator.inbound.json.dictionary.enabled=true
citrus.simulator.inboundJsonDictionary=classpath:dictionary/inbound_mappings.properties
citrus.simulator.outbound.json.dictionary.enabled=true
citrus.simulator.outboundJsonDictionary=classpath:dictionary/outbound_mappings.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you have the possibility to define mapping files that map JsonPath expression evaluation with pre defined values in the dictionary:</p>
</div>
<div class="paragraph">
<p>Now we have added some mapping files for inbound and outbound dictionaries. The mapping file can look like this:</p>
</div>
<div class="listingblock">
<div class="title">inbound mappings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">$.category.name=@assertThat(anyOf(is(dog),is(cat)))@
$.status=@matches(available|pending|sold|placed)@
$.quantity=@greaterThan(0)@</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">outbound mappings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">$.category.name=citrus:randomEnumValue('dog', 'cat')
$.name=citrus:randomEnumValue('hasso', 'cutie', 'fluffy')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The inbound and outbound mapping files defines several JsonPath expressions that should set predefined values before incoming and outgoing messages are validated respectively sent out.
As you can see we can use Citrus validation matchers and functions in order to get more complex value generation.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="web-service"><a class="anchor" href="#web-service"></a>5. Web Service support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simulator is able to handle SOAP Web Service calls as a server.</p>
</div>
<div class="paragraph">
<p>The generic SOAP web service support is activated by setting the property <strong>citrus.simulator.ws.enabled=true</strong>. You can do so in the basic <code>application.properties</code>
file or via system property or environment variable setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>citrus.simulator.ws.enabled</strong> property performs some auto configuration steps and loads required beans for the Spring application context
in the Spring boot application.</p>
</div>
<div class="paragraph">
<p>As SOAP web service support is not included by default in the simulator we need to add some Citrus dependencies to our project. In Maven we simply add the following dependency to the project POM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Citrus web service support --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-ws<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${citrus.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that we are ready to handle incoming SOAP Web Service calls on the simulator. When SOAP web service handling is enabled on the simulator
the SOAP envelope handling is done automatically. This means we do not have to deal with that SOAP envelope in the scenario receive and send operations. Also
the scenario receive operation has access to the SOAP action of the incoming request call. Besides that we can also <a href="#ws-soap-faults">return a SOAP fault</a> message as scenario outcome.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s move on with having a look at the SOAP related configuration options as described in the following sections.</p>
</div>
<div class="sect2">
<h3 id="web-service-config"><a class="anchor" href="#web-service-config"></a>5.1. Configuration</h3>
<div class="paragraph">
<p>Once the SOAP support is enabled on the simulator we have different configuration options. The most comfortable way is to
add a <strong>SimulatorWebServiceAdapter</strong> implementation to the classpath. The adapter provides several configuration methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SimulatorWebServiceAdapter</span> <span class="directive">implements</span> SimulatorWebServiceConfigurer {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> servletMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/services/ws/*</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        <span class="keyword">return</span> <span class="keyword">new</span> ContentBasedXPathScenarioMapper().addXPathExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">local-name(/*)</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> EndpointInterceptor<span class="type">[]</span> interceptors() {
        <span class="keyword">return</span> <span class="keyword">new</span> EndpointInterceptor<span class="type">[]</span> { <span class="keyword">new</span> LoggingEndpointInterceptor() };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapter defines methods that configure the simulator SOAP message handling. For instance we can add another mapping key extractor implementation or
add endpoint interceptors to the SOAP service call handling.</p>
</div>
<div class="paragraph">
<p>The <strong>servletMapping</strong> defines how clients can access the simulator SOAP service. Assuming the Spring boot simulator application is running on port 8080 the
SOAP service would be accessible on this URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhhost:8080/services/ws/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>The clients can send SOAP calls to that endpoint URI then. The simulator will respond with respective SOAP responses based on the called
scenario.</p>
</div>
<div class="paragraph">
<p>You can simply extend the adapter in a custom class for adding customizations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySimulatorWebServiceAdapter</span> <span class="directive">extends</span> SimulatorWebServiceAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> servletMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/my-soap-service/**</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the class is annotated with <strong>@Component</strong> annotation. This is because the adapter should be recognized by Spring in order to overwrite the default
SOAP adapter behavior. The custom adapter just overwrites the <strong>servletMapping</strong> method so the SOAP simulator API will be accessible for clients under this endpoint URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhhost:8080/my-soap-service/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the simplest way to customize the simulator SOAP support. We can also use the adapter extension directly on the Spring boot main application class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.ws.SimulatorWebServiceAdapter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorWebServiceAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> servletMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/my-soap-service/**</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        <span class="keyword">return</span> <span class="keyword">new</span> SoapActionScenarioMapper();
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="web-service-customization"><a class="anchor" href="#web-service-customization"></a>5.2. Advanced customizations</h3>
<div class="paragraph">
<p>For a more advanced configuration option we can extend the <strong>SimulatorWebServiceSupport</strong> implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.ws.SimulatorWebServiceAutoConfiguration</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorWebServiceAutoConfiguration {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span> getServletMapping() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/my-soap-service/**</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> ServletRegistrationBean messageDispatcherServlet(ApplicationContext applicationContext) {
        MessageDispatcherServlet servlet = <span class="keyword">new</span> MessageDispatcherServlet();
        servlet.setApplicationContext(applicationContext);
        servlet.setTransformWsdlLocations(<span class="predefined-constant">true</span>);
        <span class="keyword">return</span> <span class="keyword">new</span> ServletRegistrationBean(servlet, getDispatcherServletMapping());
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that configuration option we can overwrite SOAP support auto configuration features on the simulator such as the <strong>messageDispatcherServlet</strong>.
We extend the <strong>SimulatorWebServiceAutoConfiguration</strong> implementation directly.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-service-response"><a class="anchor" href="#web-service-response"></a>5.3. SOAP response</h3>
<div class="paragraph">
<p>When using Http SOAP services we may want to respond to the calling client with a synchronous SOAP response message. As the SOAP communication is automatically handled
within the simulator we can simply send back a response message in the scenario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .soap()
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Hello xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Say Hello!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/Hello&gt;</span><span class="delimiter">&quot;</span></span>)
            .soapAction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);

        scenario
            .soap()
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;HelloResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi there!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/HelloResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the Citrus Java DSL provides special SOAP related methods that specify the SOAP request and response data. Once again the SOAP envelope is automatically handled
so we do not have to add this here. The receive operation is able to verify the SOAP action header value. In addition to that we are able to specify the synchronous SOAP response message.</p>
</div>
<div class="paragraph">
<p>When using SOAP message protocols we may need to send SOAP faults as response message. This is handled in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-service-faults"><a class="anchor" href="#web-service-faults"></a>5.4. SOAP faults</h3>
<div class="paragraph">
<p>The simulator is in charge of sending proper response messages to the calling client. When using SOAP we might also want to send
back a SOAP fault message. Therefore the default Web Service scenario implementation also provides fault responses as scenario result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GoodNightScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure() {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;GoodNight xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Go to sleep!</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/GoodNight&gt;</span><span class="delimiter">&quot;</span></span>)
            .header(SoapMessageHeaders.SOAP_ACTION, <span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span>);

        scenario
            .sendFault()
            .faultCode(<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://citrusframework.org}CITRUS:SIM-1001</span><span class="delimiter">&quot;</span></span>)
            .faultString(<span class="string"><span class="delimiter">&quot;</span><span class="content">No sleep for me!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a simple fault generating SOAP scenario. The base class <strong>SimulatorWebServiceScenario</strong> provides
the <strong>sendFault()</strong> method in order to create proper SOAP fault messages. The simulator automatically add SOAP envelope and SOAP fault
message details for you. So we can decide wheather to provide a success response or SOAP fault.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-service-wsdl"><a class="anchor" href="#web-service-wsdl"></a>5.5. WSDL support</h3>
<div class="paragraph">
<p>The simulator is able to read your WSDL web service specifications for auto generating simulator scenarios. The WSDL defines multiple operations with request and response message data.
The simulator reads the WSDL information and generates basic scenarios for these operations.</p>
</div>
<div class="paragraph">
<p>See the following sample how to do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorWebServiceAdapter {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> servletMapping(SimulatorWebServiceConfigurationProperties simulatorWebServiceConfiguration) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/services/ws/HelloService/v1/*</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> EndpointAdapter fallbackEndpointAdapter() {
        <span class="keyword">return</span> <span class="keyword">new</span> StaticEndpointAdapter() {
            <span class="annotation">@Override</span>
            <span class="directive">protected</span> Message handleMessageInternal(Message message) {
                <span class="keyword">return</span> <span class="keyword">new</span> SoapFault()
                        .faultActor(<span class="string"><span class="delimiter">&quot;</span><span class="content">SERVER</span><span class="delimiter">&quot;</span></span>)
                        .faultCode(<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://localhost:8080/HelloService/v1}HELLO:ERROR-1001</span><span class="delimiter">&quot;</span></span>)
                        .faultString(<span class="string"><span class="delimiter">&quot;</span><span class="content">Internal server error</span><span class="delimiter">&quot;</span></span>);
            }
        };
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="directive">static</span> WsdlScenarioGenerator scenarioGenerator() {
        WsdlScenarioGenerator generator = <span class="keyword">new</span> WsdlScenarioGenerator(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd/Hello.wsdl</span><span class="delimiter">&quot;</span></span>));
        <span class="keyword">return</span> generator;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above uses a <code>WsdlScenarioGenerator</code> as Spring bean. The generator requires the WSDL file location <code>xsd/Hello.wsdl</code> and the
servlet mapping path for this API.</p>
</div>
<div class="paragraph">
<p>Also we set a custom fallback endpoint adapter. This one is used when no scenario matches the incoming request or when the scenario itself did not produce a proper response because of
some validation error. The fallback endpoint adapter sends a default SOAP fault message with <strong>"Internal server error"</strong>.</p>
</div>
<div class="paragraph">
<p>On startup the generator dynamically generates a scenario for each operation defined in that WSDL file. You can review all generated scenarios in the user interface.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the sample WSDL file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;wsdl:definitions</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">xmlns:tns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">xmlns:wsdl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/wsdl/</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">xmlns:soap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/wsdl/soap/</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;wsdl:documentation&gt;</span>Version 1.0<span class="tag">&lt;/wsdl:documentation&gt;</span>

  <span class="tag">&lt;wsdl:types&gt;</span>
    <span class="tag">&lt;xs:schema</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">attributeFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unqualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloResponse</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodBye</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodByeResponse</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNightResponse</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xs:schema&gt;</span>
  <span class="tag">&lt;/wsdl:types&gt;</span>

  <span class="tag">&lt;wsdl:message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:Hello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/wsdl:message&gt;</span>

  <span class="tag">&lt;wsdl:message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:HelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/wsdl:message&gt;</span>

  <span class="tag">&lt;wsdl:message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodBye</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodBye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/wsdl:message&gt;</span>

  <span class="tag">&lt;wsdl:message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodByeResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodByeResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/wsdl:message&gt;</span>

  <span class="tag">&lt;wsdl:message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodNight</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/wsdl:message&gt;</span>

  <span class="tag">&lt;wsdl:message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNightResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodNightResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/wsdl:message&gt;</span>

  <span class="tag">&lt;wsdl:portType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloPortType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;wsdl:input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:Hello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;wsdl:output</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloResponse</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:HelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/wsdl:operation&gt;</span>
    <span class="tag">&lt;wsdl:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbye</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;wsdl:input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodBye</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodBye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;wsdl:output</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodByeResponse</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodByeResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/wsdl:operation&gt;</span>
    <span class="tag">&lt;wsdl:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodnight</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;wsdl:input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodNight</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;wsdl:output</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNightResponse</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GoodNightResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/wsdl:operation&gt;</span>
  <span class="tag">&lt;/wsdl:portType&gt;</span>

  <span class="tag">&lt;wsdl:service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wsdl:port</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloServiceHTTP</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:HelloServiceHTTPBinding</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;soap:address</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/services/ws/HelloService/v1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/wsdl:port&gt;</span>
  <span class="tag">&lt;/wsdl:service&gt;</span>

  <span class="tag">&lt;wsdl:binding</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloServiceHTTPBinding</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:HelloPortType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;soap:binding</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">document</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transport</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/http</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;wsdl:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;soap:operation</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">document</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">soapAction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;wsdl:input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/wsdl:input&gt;</span>
      <span class="tag">&lt;wsdl:output</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/wsdl:output&gt;</span>
    <span class="tag">&lt;/wsdl:operation&gt;</span>
    <span class="tag">&lt;wsdl:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbye</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;soap:operation</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">document</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">soapAction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodBye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;wsdl:input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodBye</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/wsdl:input&gt;</span>
      <span class="tag">&lt;wsdl:output</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodByeResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/wsdl:output&gt;</span>
    <span class="tag">&lt;/wsdl:operation&gt;</span>
    <span class="tag">&lt;wsdl:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodnight</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;soap:operation</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">document</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">soapAction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;wsdl:input</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNight</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/wsdl:input&gt;</span>
      <span class="tag">&lt;wsdl:output</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodNightResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/wsdl:output&gt;</span>
    <span class="tag">&lt;/wsdl:operation&gt;</span>
  <span class="tag">&lt;/wsdl:binding&gt;</span>

<span class="tag">&lt;/wsdl:definitions&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The WSDL above defines a <strong>hello</strong> operation with <strong>Hello</strong> as input and <strong>HelloResponse</strong> as output. The SOAP action is defined as <strong>Hello</strong>.</p>
</div>
<div class="paragraph">
<p>The generated scenario for this operation verifies that the request is a valid <strong>Hello</strong> request according to the XSD schema definition in the WSDL. Also the scenario verifies the basic XML structure of that message.</p>
</div>
<div class="paragraph">
<p>Only in case these verification steps are performed successfully the simulator scenario generates a proper response <strong>HelloResponse</strong>. The generated scenario is able to create dynamic values in the response according to the XSD schema in the WSDL. We will cover this feature in
more detail on later in this chapter.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the communication that the generated scenario is going to perform:</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="CodeRay highlight"><code>&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;SOAP-ENV:Header/&gt;
    &lt;SOAP-ENV:Body&gt;
        &lt;Hello xmlns="http://citrusframework.org/schemas/hello"&gt;Say Hello!&lt;/Hello&gt;
    &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="CodeRay highlight"><code>&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;SOAP-ENV:Header/&gt;
    &lt;SOAP-ENV:Body&gt;
        &lt;HelloResponse xmlns="http://citrusframework.org/schemas/hello"&gt;GL29HT&lt;/hel:HelloResponse&gt;
    &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>Hello</strong> SOAP request matches all verification steps on the simulator for this operation. Following from that we receive a generated <strong>HelloResponse</strong> response message with some sample data. The simulator
is able to generate dynamic values such as <strong>GL29HT</strong> which is according to the WSDL schema rules a string value.</p>
</div>
<div class="paragraph">
<p>This is how we always get a proper generated response from the simulator API. The <strong>HelloService</strong> WSDL specification defines the returned objects and how to validate the incoming requests.</p>
</div>
<div class="paragraph">
<p>Just in case we sent an invalid request to the simulator we do not get a proper response. For instance if we sent a wrong SOAP action we receive following fault response:</p>
</div>
<div class="listingblock">
<div class="title">Fault response</div>
<div class="content">
<pre class="CodeRay highlight"><code>&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;SOAP-ENV:Header/&gt;
    &lt;SOAP-ENV:Body&gt;
        &lt;SOAP-ENV:Fault&gt;
            &lt;faultcode xmlns:HELLO="http://localhost:8080/HelloService/v1"&gt;HELLO:ERROR-1001&lt;/faultcode&gt;
            &lt;faultstring xmlns:xml="http://www.w3.org/XML/1998/namespace" xml:lang="en"&gt;Internal server error&lt;/faultstring&gt;
            &lt;faultactor&gt;SERVER&lt;/faultactor&gt;
        &lt;/SOAP-ENV:Fault&gt;
    &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result we get a SOAP fault message with fault code <strong>ERROR-1001</strong> and message <strong>"Internal server error"</strong> as defined in the fallback endpoint adapter.
You will also see the failed scenario activity with proper error message in the user interface then.</p>
</div>
<div class="sect3">
<h4 id="wsdl-system-properties"><a class="anchor" href="#wsdl-system-properties"></a>5.5.1. WSDL system properties</h4>
<div class="paragraph">
<p>The simulator WSDL auto generate scenario feature can also be activated using pure property settings on the Spring boot application. Instead of adding the Spring bean <code>WsdlScenarioGenerator</code> in your
simulator configuration you could just set the following properties on the simulator application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># Enable SOAP web service support
citrus.simulator.ws.wsdl.enabled=true
citrus.simulator.ws.wsdl.location=classpath:xsd/Hello.wsdl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also use environment variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">CITRUS_SIMULATOR_WS_WSDL_ENABLED=true
CITRUS_SIMULATOR_WS_WSDL_LOCATION=classpath:xsd/Hello.wsdl</code></pre>
</div>
</div>
<div class="paragraph">
<p>We just add the WSDL location and everything else is auto configuration done in the simulator application.</p>
</div>
</div>
<div class="sect3">
<h4 id="data-dictionaries-2"><a class="anchor" href="#data-dictionaries-2"></a>5.5.2. Data dictionaries</h4>
<div class="paragraph">
<p>The auto generated WSDL scenarios make us of so called data dictionaries in order to create dynamic values both in request and response messages. The data dictionaries
are a well known Citrus functionality that enable us to centralize data manipulation via XPath expressions for example. Each XML message construction will consult the data dictionary
for some translation of elements and attributes.</p>
</div>
<div class="paragraph">
<p>The auto generated scenario references both inbound and outbound data dictionaries. We simply need to enable those in the Spring boot <code>application.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">citrus.simulator.inbound.xml.dictionary.enabled=true
citrus.simulator.outbound.xml.dictionary.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>These property settings automatically activate the data dictionaries and you will get random numbers and strings in all generated WSDL messages. For incoming requests the dictionary makes sure
that elements and attributes are ignored in validation by default. This is a good idea as we can not know all data that is sent to the simulator.</p>
</div>
<div class="paragraph">
<p>Fortunately you have the possibility to define mapping files that map XPath expression evaluation with pre defined values in the dictionary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">citrus.simulator.inbound.xml.dictionary.enabled=true
citrus.simulator.inboundXmlDictionary=classpath:dictionary/inbound_mappings.xml
citrus.simulator.outbound.xml.dictionary.enabled=true
citrus.simulator.outboundXmlDictionary=classpath:dictionary/outbound_mappings.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have added some mapping files for inbound and outbound dictionaries. The mapping file can look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;</span>
<span class="tag">&lt;properties&gt;</span>
  <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//sim:Hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Say Hello!<span class="tag">&lt;/entry&gt;</span>
  <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//sim:GoodBye</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Say GoodBye!<span class="tag">&lt;/entry&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The inbound mapping file defines two XPath expressions that should set predefined values before incoming request are validated. So in this case we set <code>Say Hello!</code> as string element value
to the element <code>&lt;Hello&gt;</code> in the request. When dealing with XML and XPath we need to take care on proper namespace handling. In the XPath expression above we make use of the namespace prefix <code>sim:</code>. This prefix resoves to a
proper namespace in the WSDL schema for <code>Hello</code> messages and is defined in a global namespace context within the Spring application.</p>
</div>
<div class="paragraph">
<p>You can add that namespace context as Spring bean for instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> NamespaceContextBuilder namespaceContextBuilder() {
    NamespaceContextBuilder namespaceContextBuilder = <span class="keyword">new</span> NamespaceContextBuilder();
    namespaceContextBuilder.getNamespaceMappings().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">sim</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="delimiter">&quot;</span></span>);

    <span class="keyword">return</span> namespaceContextBuilder;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that we are able to use the global <code>sim</code> namespace prefix in all XPath expressions. The XPath expression evaluation will take care on proper namespace handling then.</p>
</div>
<div class="paragraph">
<p>Of course we can also add outbound bindings for creating special response element values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;</span>
<span class="tag">&lt;properties&gt;</span>
  <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//sim:HelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Hello!<span class="tag">&lt;/entry&gt;</span>
  <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//sim:GoodByeResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>GoodBye!<span class="tag">&lt;/entry&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the auto generated response for <code>HelloResponse</code> messages will always use <code>Hello!</code> as value. in combination with Citrus functions we are able to define more complex response element values in auto generated messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;</span>
<span class="tag">&lt;properties&gt;</span>
  <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//sim:HelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>citrus:randomString(10)<span class="tag">&lt;/entry&gt;</span>
  <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//sim:GoodByeResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>citrus:randomEnumValue('GoodBye!', 'SeeYaLater!', 'ByeBye!')<span class="tag">&lt;/entry&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms"><a class="anchor" href="#jms"></a>6. JMS support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simulator is able to receive messages from message brokers using the <strong>Java Message Service</strong> API (JMS). As a consumer the simulator constantly polls JMS destinations (queue or topic)
for incoming request messages. When the queue is of synchronous nature the simulator is able to send synchronous response messages.</p>
</div>
<div class="paragraph">
<p>The generic jms support is activated by setting the property <strong>citrus.simulator.jms.enabled=true</strong>. You can do so in the basic <code>application.properties</code>
file or via system property or environment variable setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>citrus.simulator.jms.enabled</strong> property performs some auto configuration steps and loads required beans for the Spring application context
in the Spring boot application.</p>
</div>
<div class="paragraph">
<p>As JMS support is not included by default in the simulator we need to add some Citrus dependencies to our project. In Maven we simply add the following dependency to the project POM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Citrus web service support --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-jms<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${citrus.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also we might want to add JMS vendor specific connection factory implementations depending on what JMS message broker you are using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- ActiveMQ message broker support --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.activemq<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>activemq-broker<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${activemq.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.activemq<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>activemq-spring<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${activemq.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.xbean<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>xbean-spring<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>4.4<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With that piece of configuration we are ready to handle incoming JMS messages on the simulator. Of course we need a JMS connection factory and other JMS related
configuration options as described in the following sections.</p>
</div>
<div class="sect2">
<h3 id="jms-config"><a class="anchor" href="#jms-config"></a>6.1. Configuration</h3>
<div class="paragraph">
<p>Once the JMS support is enabled on the simulator we have different configuration options. The most comfortable way is to
add a <strong>SimulatorJmsAdapter</strong> implementation to the project. The adapter provides several configuration methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SimulatorJmsAdapter</span> <span class="directive">implements</span> SimulatorJmsConfigurer {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> ConnectionFactory connectionFactory() {
        <span class="keyword">return</span> <span class="keyword">new</span> SingleConnectionFactory();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> destinationName() {
        <span class="keyword">return</span> <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus.simulator.jms.destination</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.Simulator.Inbound</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> useSoapEnvelope() {
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        <span class="keyword">return</span> <span class="keyword">new</span> ContentBasedXPathScenarioMapper().addXPathExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">local-name(/*)</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapter defines methods that configure the simulator JMS handling. For instance we can add another scenario mapper implementation or
enable automatic SOAP envelope handling.</p>
</div>
<div class="paragraph">
<p>The <strong>destinationName</strong> defines the incoming JMS destination to poll as a consumer. The <strong>connectionFactory</strong> is mandatory in order to connect to a JMS
message broker.</p>
</div>
<div class="paragraph">
<p>You can simply extend the adapter in a custom class for adding customizations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySimulatorJmsAdapter</span> <span class="directive">extends</span> SimulatorJmsAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> destinationName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">JMS.Queue.simulator.inbound</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ConnectionFactory connectionFactory() {
        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the class is annotated with <strong>@Component</strong> annotation. This is because the adapter should be recognized by Spring in order to overwrite the default
JMS adapter behavior. The custom adapter just overwrites the <strong>connectionFactory</strong> and <strong>destinationName</strong> methods so the JMS simulator will connect to the ActiveMQ message broker
and listen for incoming requests on that queue <strong>JMS.Queue.simulator.inbound</strong>.</p>
</div>
<div class="paragraph">
<p>This is the simplest way to customize the simulator JMS support. We can also use the adapter extension directly on the Spring boot main application class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.jms.SimulatorJmsAdapter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorJmsAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> destinationName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">JMS.Queue.simulator.inbound</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ConnectionFactory connectionFactory() {
        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done the simulator polls the target destination for new incoming request messages. As usual the simulator maps incoming requests to simulator scenarios for execution. Inside
the scenario you can receive the JMS request messages as usual using the scenario endpoint. The scenario logic is then able to provide a response message that is sent back to the synchronous reply
destination if any is specified.</p>
</div>
</div>
<div class="sect2">
<h3 id="jms-async"><a class="anchor" href="#jms-async"></a>6.2. Asynchronous communication</h3>
<div class="paragraph">
<p>For asynchronous communication we can define normal JMS destination endpoints in Citrus in order to autowire those in the scenario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> destinationName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">JMS.Queue.simulator.inbound</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ConnectionFactory connectionFactory() {
        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> JmsEndpoint replyEndpoint() {
        <span class="keyword">return</span> CitrusEndpoints.jms()
                              .asynchronous()
                              .destinationName(<span class="string"><span class="delimiter">&quot;</span><span class="content">JMS.Queue.simulator.reply</span><span class="delimiter">&quot;</span></span>)
                              .connectionFactory(connectionFactory())
                              .build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we are able to create several JMS endpoints in Citrus. We can autowire those endpoints in a scenario for sending back an asynchronous response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloJmsScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> JmsEndpoint replyEndpoint;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Hello xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;user&gt;@ignore@&lt;/user&gt;</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/Hello&gt;</span><span class="delimiter">&quot;</span></span>)
            .extractFromPayload(<span class="string"><span class="delimiter">&quot;</span><span class="content">/Hello/user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send(replyEndpoint)
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;HelloResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;text&gt;Hi there ${userName}!&lt;/text&gt;</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/HelloResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this sample above we receive the scenario request message as usual using the scenario endpoint. After that we send back a response on the replyEndpoint which has been
injected to the scenario using the <code>@Autowired</code> annotation.</p>
</div>
<div class="paragraph">
<p>In general scenarios can interact with all Citrus endpoints that get defined as Spring beans in the application context configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="jms-sync"><a class="anchor" href="#jms-sync"></a>6.3. Synchronous communication</h3>
<div class="paragraph">
<p>When dealing with synchronous communication the message producer waits for a reply message on a reply destination. This reply destination handling is automatically done
within the simulator. So when we have synchronous communication we simply send back a response message using the scenario endpoint. The simulator makes sure that the response is
provided to the waiting producer on the reply destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloJmsScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Hello xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;user&gt;@ignore@&lt;/user&gt;</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/Hello&gt;</span><span class="delimiter">&quot;</span></span>)
            .extractFromPayload(<span class="string"><span class="delimiter">&quot;</span><span class="content">/Hello/user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;HelloResponse xmlns=</span><span class="char">\&quot;</span><span class="content">http://citrusframework.org/schemas/hello</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;text&gt;Hi there ${userName}!&lt;/text&gt;</span><span class="delimiter">&quot;</span></span> +
                     <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/HelloResponse&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The synchronous JMS communication needs to be enabled on the JMS simulator adapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.jms.SimulatorJmsAdapter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorJmsAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> destinationName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">JMS.Queue.simulator.inbound</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ConnectionFactory connectionFactory() {
        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> synchronous(SimulatorJmsConfigurationProperties simulatorJmsConfiguration) {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the JMS communication support within the simulator. Read more about other messaging transports such as Http REST or SOAP in this documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="endpoint"><a class="anchor" href="#endpoint"></a>7. Endpoint support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have seen how the simulator handles different transports such as <a href="#rest">Http REST</a>, <a href="#web-service">SOAP web services</a> and <a href="#jms">JMS</a>.
Now the simulator is also able to handle other message transports such as mail communication, JMX mbean server, RMI invocations and much more. The
simulator is able to deal with any kind of endpoint component that is supported in Citrus framework.</p>
</div>
<div class="paragraph">
<p>The generic endpoint support is activated by setting the property <strong>citrus.simulator.endpoint.enabled=true</strong>. You can do so in the basic <code>application.properties</code>
file or via system property or environment variable setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>citrus.simulator.endpoint.enabled</strong> property performs some auto configuration steps and loads required beans for the Spring application context
in the Spring boot application. Once we use that feature we can have any Citrus endpoint component as inbound source for simulator scenarios. This means
we can have a mail server or a RMI server that is simulated with proper response messages.</p>
</div>
<div class="sect2">
<h3 id="endpoint-config"><a class="anchor" href="#endpoint-config"></a>7.1. Configuration</h3>
<div class="paragraph">
<p>As we are using generic Citrus endpoint components as inbound source we need to configure those endpoint components. The most comfortable way is to
add a <strong>SimulatorEndpointComponentAdapter</strong> implementation to the classpath. The adapter provides several configuration methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SimulatorEndpointComponentAdapter</span> <span class="directive">implements</span> SimulatorEndpointComponentConfigurer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="directive">abstract</span> Endpoint endpoint(ApplicationContext applicationContext);

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> useSoapEnvelope() {
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        <span class="keyword">return</span> <span class="keyword">new</span> ContentBasedXPathScenarioMapper().addXPathExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">local-name(/*)</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapter defines methods that configure the endpoint component used as inbound source. As usual we can set the scenario mapper implementation or
add automatic SOAP envelope support.</p>
</div>
<div class="paragraph">
<p>More importantly we need to define an inbound endpoint that is used as source for scenarios. Let&#8217;s have a simple endpoint component adapter example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.simulator.endpoint.SimulatorEndpointComponentAdapter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simulator</span> <span class="directive">extends</span> SimulatorEndpointComponentAdapter {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(Simulator.class, args);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Endpoint endpoint(ApplicationContext applicationContext) {
        MailServer mailServer = <span class="keyword">new</span> MailServer();
        mailServer.setPort(<span class="integer">2222</span>);
        mailServer.setAutoStart(<span class="predefined-constant">true</span>);

        <span class="keyword">return</span> mailServer;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ScenarioMapper scenarioMapper() {
        <span class="keyword">return</span> <span class="keyword">new</span> ContentBasedXPathScenarioMapper()
                        .addNamespaceMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span>)
                        .addXPathExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">/mail:mail-message/mail:subject</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom adapter defines a Citrus mail server endpoint that should be used as inbound source. Any mail message that arrives at this mail server component will
trigger a new simulator scenario then. Also we overwrite the scenario mapper implementation. The sample uses a content based XPath mapper that uses the mail subject
value as scenario mapping key.</p>
</div>
<div class="paragraph">
<p>As mail server endpoint support is not included by default in the simulator we need to add some Citrus dependencies to our project. In Maven we simply add the following dependency to the project POM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Citrus web service support --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-mail<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${citrus.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration would lead us to a mail server that responds to incoming mail messages base on the mail subject. So we can have several simulator
scenarios for different mail messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scenario</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloScenario</span> <span class="directive">extends</span> AbstractSimulatorScenario {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioDesigner scenario) {
        scenario
            .receive()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;mail-message xmlns=</span><span class="char">\&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;from&gt;user@citrusframework.org&lt;/from&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;to&gt;citrus@citrusframework.org&lt;/to&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;cc&gt;&lt;/cc&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;bcc&gt;&lt;/bcc&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;subject&gt;Hello&lt;/subject&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="delimiter">&quot;</span></span> +
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;contentType&gt;text/plain; charset=utf-8&lt;/contentType&gt;</span><span class="delimiter">&quot;</span></span> +
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;content&gt;Say Hello!&lt;/content&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/mail-message&gt;</span><span class="delimiter">&quot;</span></span>);

        scenario
            .send()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;mail-response xmlns=</span><span class="char">\&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;code&gt;250&lt;/code&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;message&gt;OK&lt;/message&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/mail-response&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The scenario implementation above is listening for mail messages of subject <strong>Hello</strong>. The
mail XML marshalling is automatically done by Citrus. This is the usual way how the Citrus mail component handles mail messages and responses. That means we can use the default Citrus
features in our simulator, too. The scenario sends back a positive mail response to the calling client.</p>
</div>
<div class="paragraph">
<p>This is how we can use any Citrus endpoint component as simulator inbound source. This gives us the opportunity to support a huge set of message transports and
message types in our simulator applications. Each incoming request on the endpoint component triggers a new simulator scenario.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user-interface"><a class="anchor" href="#user-interface"></a>8. User interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simulator application is started as a Spring boot web application. If you open your browser and point to the running simulator instance at <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>
you will see the default welcome page.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/default-ui.png" alt="default ui"></span></p>
</div>
<div class="paragraph">
<p>The default ui is straight forward and limited to viewing Json response data returned by the simulator REST API. Fortunately there is also a more comfortable user interface based
on Angular2 available. Users can then access an administrative web user interface in order to review the simulator status and list all executed scenarios and their outcome.</p>
</div>
<div class="paragraph">
<p>The simulator Angular2 user interface comes as dependency that is added to the simulator project. In Maven we simply add the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Simulator web ui --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-simulator-ui<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${citrus.simulator.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can start the simulator and open your browser pointing to the simulator UI at <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>. You will see the extended
web application user interface that gives you information about the simulator.</p>
</div>
<div class="sect2">
<h3 id="ui-dashboard"><a class="anchor" href="#ui-dashboard"></a>8.1. Dashboard</h3>
<div class="paragraph">
<p>The simulator dashboard gives you a quick overview of the numbers and facts on your simulator project.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/dashboard.png" alt="dashboard"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="ui-scenarios"><a class="anchor" href="#ui-scenarios"></a>8.2. Scenarios</h3>
<div class="paragraph">
<p>The user interface lists all available scenarios. These are scenarios that are available for automatic mapping when incoming requests are handled.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/scenario-list.png" alt="scenario list"></span></p>
</div>
<div class="paragraph">
<p>In case you open one of the listed scenarios you get a detailed information page of that specific scenario.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/scenario-details.png" alt="scenario details"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="ui-activity"><a class="anchor" href="#ui-activity"></a>8.3. Activities</h3>
<div class="paragraph">
<p>Each time a scenario instance is started the user interface will display that scenario as running activity.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/scenario-activity-list.png" alt="scenario activity list"></span></p>
</div>
<div class="paragraph">
<p>You can view the details of that scenario activity when opening a specific activity entry.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/scenario-activity-details.png" alt="scenario activity details"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="messages"><a class="anchor" href="#messages"></a>8.4. Messages</h3>
<div class="paragraph">
<p>When scenarios get executed they usually exchange several messages in request and response communication. These messages are also stored in the simulator so you
can review all exchanged messages on a scenario in the user interface.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/messages.png" alt="messages"></span></p>
</div>
<div class="paragraph">
<p>Open a specific message entry and you will see the details such as header information and message payload details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="starter"><a class="anchor" href="#starter"></a>9. Starter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Usually the simulator provides simulation for server APIs so clients are able to call the simulator. In some cases things may go the other way round. The simulator is able to start
scenarios via web user interface. This way the simulator is able to start a communication instead of waiting for requests to arrive. In this case the simulator is able to
act as client in order to call other server APIs.</p>
</div>
<div class="paragraph">
<p>This mechanism is covered by starter implementations on the simulator. In fact the starter implementations are simulator scenarios that also implement the <code>ScenarioStarter</code>
interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ScenarioStarter</span> <span class="directive">extends</span> SimulatorScenario {

    <span class="keyword">default</span> <span class="predefined-type">Collection</span>&lt;ScenarioParameter&gt; getScenarioParameters() {
        <span class="keyword">return</span> <span class="predefined-type">Collections</span>.EMPTY_LIST;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>ScenarioStarter</strong> extends the <strong>SimulatorScenario</strong> interface. So each scenario can also act as a starter. See the following sample starter implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Starter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloStarter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloStarter</span> <span class="directive">extends</span> AbstractScenarioStarter {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> JmsEndpoint outboundEndpoint;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioRunner scenario) {
        scenario.send(outboundEndpoint)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from simulator!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The starter class is annotated with <code>@Starter</code> annotation and gets a unique name. The class extends from <code>AbstractScenarioStarter</code> for most comfortable setup. In the run
method we can add custom scenario logic as usual. Inthe sample above we send a JMS message to some endpoint that has been injected as Spring bean component.</p>
</div>
<div class="paragraph">
<p>All these starter implementations in the project are automatically loaded in the simulator user interface so you can launch those scenarios.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/scenario-starter-list.png" alt="scenario starter list"></span></p>
</div>
<div class="paragraph">
<p>The list of available scenarios now also contains the starter implementations. The launch button brings you to the starter detail page.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/scenario-starter-details.png" alt="scenario starter details"></span></p>
</div>
<div class="paragraph">
<p>The scenario starter is able to define parameters that need to be filled before the starter is executed. In case you press the <strong>Launch</strong> button the scenario is executed with those parameters.
The parameter HTML form is auto generated from the starter class. In the following section we see how the starter class is able to define those parameters.</p>
</div>
<div class="sect2">
<h3 id="starter-parameter"><a class="anchor" href="#starter-parameter"></a>9.1. Starter Parameter</h3>
<div class="paragraph">
<p>Starter implementations are executable in the simulator user interface. The starter is able to define parameters that should be filled out before the starter performs its actions. In
the starter class you can specify the parameters as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Starter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloStarter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloStarter</span> <span class="directive">extends</span> AbstractScenarioStarter {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> JmsEndpoint outboundEndpoint;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run(ScenarioRunner scenario) {
        scenario.send(outboundEndpoint)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">${greeting}</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ScenarioParameter&gt; getScenarioParameters() {
        <span class="predefined-type">List</span>&lt;ScenarioParameter&gt; scenarioParameters = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// greeting (text box)</span>
        scenarioParameters.add(<span class="keyword">new</span> ScenarioParameterBuilder()
                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)
                .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">Greeting Text</span><span class="delimiter">&quot;</span></span>)
                .required()
                .textbox()
                .value(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hi there!</span><span class="delimiter">&quot;</span></span>)
                .build());

        <span class="keyword">return</span> scenarioParameters;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above defines a parameter called <strong>greeting</strong>. The parameter is of type <code>textbox</code> and has a default value <strong>Hi there!</strong>. This parameter
information is used to aut generate a HTML form in the simulator user interface. You can specify as multiple parameters of different types.</p>
</div>
<div class="hdlist">
<div class="title">Parameter types</div>
<table>
<tr>
<td class="hdlist1">
textbox
</td>
<td class="hdlist2">
<p>Renders a normal HTML input field</p>
</td>
</tr>
<tr>
<td class="hdlist1">
textarea
</td>
<td class="hdlist2">
<p>Renders a textarea input field</p>
</td>
</tr>
<tr>
<td class="hdlist1">
dropdown
</td>
<td class="hdlist2">
<p>Renders a dropdown select field with predefined options</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Parameters can be required or optional and receive a label that is displayed in the HTML form. Also you can add default values.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="samples"><a class="anchor" href="#samples"></a>10. Samples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documentation can only provide theoretical insights of what the application is capable to do or not to do. Good sample projects
help both beginners and experts to reach complete understanding of how the simulator works in different environments.</p>
</div>
<div class="paragraph">
<p>Following from that we try to provide sample project that demonstrate the simulator usage in real world examples. Please see the following
sample projects with complete code available on <a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples">github</a>.</p>
</div>
<div class="sect2">
<h3 id="samples-rest"><a class="anchor" href="#samples-rest"></a>10.1. REST sample</h3>
<div class="dlist">
<div class="title">Sample repositories</div>
<dl>
<dt class="hdlist1">Http REST</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-rest" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-rest</a></p>
</dd>
<dt class="hdlist1">Auto generated from swagger</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-swagger" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-swagger</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="samples-soap"><a class="anchor" href="#samples-soap"></a>10.2. SOAP sample</h3>
<div class="dlist">
<div class="title">Sample repositories</div>
<dl>
<dt class="hdlist1">Http SOAP</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-ws" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-ws</a></p>
</dd>
<dt class="hdlist1">Http SOAP client</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-ws-client" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-ws-client</a></p>
</dd>
<dt class="hdlist1">Auto generated from WSDL</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-wsdl" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-wsdl</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="samples-jms"><a class="anchor" href="#samples-jms"></a>10.3. JMS sample</h3>
<div class="dlist">
<div class="title">Sample repositories</div>
<dl>
<dt class="hdlist1">JMS synchronous</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-jms" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-jms</a></p>
</dd>
<dt class="hdlist1">JMS asynchronous</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-jms-fax" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-jms-fax</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="samples-mail"><a class="anchor" href="#samples-mail"></a>10.4. Mail sample</h3>
<div class="dlist">
<div class="title">Sample repositories</div>
<dl>
<dt class="hdlist1">Mail endpoint simulator</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-mail" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-mail</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="samples-combined"><a class="anchor" href="#samples-combined"></a>10.5. Combined sample</h3>
<div class="dlist">
<div class="title">Sample repositories</div>
<dl>
<dt class="hdlist1">Http REST and JMS combined</dt>
<dd>
<p><a href="https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-combined" class="bare">https://github.com/christophd/citrus-simulator/tree/master/simulator-samples/sample-combined</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="links"><a class="anchor" href="#links"></a>11. Links &amp; Further reading</h2>
<div class="sectionbody">
<div class="hdlist">
<div class="title">Reading material</div>
<table>
<tr>
<td class="hdlist1">
<a href="https://www.citrusframework.org/reference/html/">Citrus manual</a>
</td>
<td class="hdlist2">
<p>gives you a detailed description of all Citrus features</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/christophd/citrus-simulator/blob/master/simulator-samples">Sample projects</a>
</td>
<td class="hdlist2">
<p>demonstrate typical simulator scenarios with different message transports</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://www.citrusframework.org/docs/history">ChangeLog</a>
</td>
<td class="hdlist2">
<p>shows the release history</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<a href="https://github.com/christophd/citrus-simulator/blob/master/simulator-docs/contributing.md">Contributing</a>
</td>
<td class="hdlist2">
<p>explains how you can contribute to this project</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.0<br>
Last updated 2017-09-12 09:44:23 MESZ
</div>
</div>
<style>

    #footer-sponsor {
        position: absolute;
        bottom: 5px;
        right: 25px;
        float: right;
    }

</style>
<div id="footer-sponsor">
    <a href="https://www.consol.de" target="_blank" alt="ConSol Software GmbH"><img src="images/sponsor-logo.png" /></a>
</div>
</body>
</html>